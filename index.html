<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="icon" type="image/x-icon" href="assets/logoKelas.png" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-indigo-500">
    <header>
      <h1 class="font-bold text-center text-3xl text-white">
        Replay link generate Format
      </h1>
    </header>
    <main>
      <section class="m-auto p-4 border rounded-lg bg-white w-100">
        <form id="replayForm" class="space-y-4">
          <div>
            <label for="title" class="block mb-1 font-medium">Title</label>
            <input
              type="text"
              id="title"
              name="title"
              class="w-full p-2 border rounded-lg"
              required
              placeholder="Ex: Matkul|Materi|Dosen"
              autofocus
              autocapitalize="word"
            />
          </div>
          <div>
            <label for="linkReplay" class="block mb-1 font-medium">Url: </label>
            <input
              type="url"
              id="linkReplay"
              name="linkReplay"
              class="w-full p-2 border rounded-lg"
              required
              placeholder="Ex: https://example.com/replay"
            />
          </div>
          <button
            type="submit"
            class="bg-indigo-500 text-white px-4 py-2 w-full font-semibold rounded-lg hover:bg-indigo-600"
          >
            Generate format
          </button>
        </form>
        <div id="result" class="mt-4 p-4 border rounded bg-gray-100 hidden">
          <h3 class="font-semibold text-xl mb-2">Generated format</h3>
          <p id="replayLink" class="text-blue-600 break-all"></p>
        </div>
      </section>

      <div class="m-4 flex gap-2">
        <button
          id="exportCSV"
          class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600"
        >
          Export CSV
        </button>

        <button
          id="exportExcel"
          class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700"
        >
          Export Excel
        </button>
      </div>
      <section class="m-4 p-4 border rounded-lg bg-white">
        <!-- <div class="m-4 p-4 border rounded-lg bg-yellow-100">
                <h2 class="font-bold text-2xl mb-2">Instructions</h2>
                <ol class="list-decimal list-inside space-y-2">
                    <li>Enter the title of the replay in the "Title" field.</li>
                    <li>Enter the URL of the replay in the "Url" field.</li>
                    <li>Click the "Generate format" button to create the formatted replay link.</li>
                    <li>The generated format will appear below the form.</li>
                </ol>
            </div> -->
      </section>
    </main>
    <script>
      const exportCSVBtn = document.getElementById("exportCSV");
      const exportExcelBtn = document.getElementById("exportExcel");

      function generateCSV() {
        if (replays.length === 0) {
          alert("Data masih kosong!");
          return "";
        }

        const headers = ["Matkul", "Tanggal", "Session", "Replay"];
        const rows = replays.map((r) => [r.title, r.date, r.session, r.link]);

        let csvContent = headers.join(",") + "\n";
        rows.forEach((row) => {
          csvContent += row.map((v) => `"${v}"`).join(",") + "\n";
        });

        return csvContent;
      }

      function downloadFile(content, filename, type) {
        const blob = new Blob([content], { type });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();

        URL.revokeObjectURL(url);
      }

      exportCSVBtn.addEventListener("click", () => {
        const csv = generateCSV();
        if (!csv) return;

        downloadFile(csv, "replay-data.csv", "text/csv");
      });

      exportExcelBtn.addEventListener("click", () => {
        const csv = generateCSV();
        if (!csv) return;

        // Excel compatible
        downloadFile(csv, "replay-data.xls", "application/vnd.ms-excel");
      });
    </script>

    <script>
      const form = document.getElementById("replayForm");
      const container = document.querySelector("section:last-of-type");

      let replays = [];
      let editId = null;

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const title = form.title.value.trim();
        const dSplit = title.split("|");

        // console.log(dSplit[1]);
        // console.log(title);

        const link = form.linkReplay.value.trim();

        if (!title || !link) return;

        if (editId) {
          // UPDATE
          const replay = replays.find((r) => r.id === editId);
          replay.title = dSplit[0];
          replay.materi = dSplit[1];
          replay.session = dSplit[2];
          replay.link = link;
          editId = null;
        } else {
          // CREATE
          replays.push({
            id: Date.now(),
            title: dSplit[0],
            materi: dSplit[1],
            link,
            date: new Date().toDateString(),
            session: dSplit[2],
          });
        }

        form.reset();
        render();
      });

      function render() {
        container.innerHTML = "";

        replays.forEach((r) => {
          const card = document.createElement("div");
          card.className =
            "border flex items-start justify-between p-2 rounded-lg mb-2";

          card.innerHTML = `
        <div class="border-r-2 pr-4 replay-content">
          <p>Matkul   : ${r.title}</p>
          <p>Tanggal  : ${r.date}</p>
          <p>Materi   : ${r.materi}</p>
          <p>Session  : ${r.session}</p>
          <p>Replay   : ${r.link}</p>
        </div>

        <div class="flex flex-col gap-1 p-2">
          <button class="edit bg-yellow-400 text-white px-4 py-2 rounded-lg">Edit</button>
          <button class="delete bg-red-400 text-white px-4 py-2 rounded-lg">Delete</button>
          <button class="copy bg-gray-400 text-white px-4 py-2 rounded-lg">
            <span class="copy-label">Copy</span>
          </button>
        </div>
      `;

          // EDIT
          card.querySelector(".edit").onclick = () => {
            form.title.value = r.title + "|" + r.materi + "|" + r.session;
            form.linkReplay.value = r.link;
            editId = r.id;
          };

          // DELETE
          card.querySelector(".delete").onclick = () => {
            replays = replays.filter((x) => x.id !== r.id);
            render();
          };

          // COPY
          card.querySelector(".copy").onclick = () => {
            const text = `
Matkul   : ${r.title}
Tanggal  : ${r.date}
Materi   : ${r.materi}
Session  : ${r.session}
Replay   : ${r.link}
        `.trim();

            navigator.clipboard.writeText(text).then(() => {
              const label = card.querySelector(".copy-label");
              label.textContent = "Copied!";
              setTimeout(() => (label.textContent = "Copy"), 1500);
            });
          };

          container.appendChild(card);
        });
      }
    </script>

    <!-- <script src="main.js"></script> -->
  </body>
</html>
